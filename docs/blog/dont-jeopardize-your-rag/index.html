<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Don&#39;t jeopardize your RAG - RAG with Question Generation</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D12TFQCZTV"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());

  gtag("config", "G-D12TFQCZTV");
</script><style>:root{--accent: #2337ff;--accent-dark: #000d8a;--black: 15, 18, 25;--gray: 96, 115, 159;--gray-light: 229, 233, 240;--gray-dark: 34, 41, 57;--gray-gradient: rgba(var(--gray-light), 50%), #fff;--box-shadow: 0 2px 6px rgba(var(--gray), 25%), 0 8px 24px rgba(var(--gray), 33%), 0 16px 32px rgba(var(--gray), 33%)}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-regular.woff) format("woff");font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-bold.woff) format("woff");font-weight:700;font-style:normal;font-display:swap}body{font-family:Atkinson,sans-serif;margin:0;padding:0;text-align:left;background:linear-gradient(var(--gray-gradient)) no-repeat;background-size:100% 600px;word-wrap:break-word;overflow-wrap:break-word;color:rgb(var(--gray-dark));font-size:18px;line-height:1.7}main{width:720px;max-width:calc(100% - 2em);margin:auto;padding:1.5em 1em}h1,h2,h3,h4,h5,h6{margin:0 0 .5rem;color:rgb(var(--black));line-height:1.2;text-wrap:balance}strong,b{font-weight:700}a,a:hover{color:var(--accent)}textarea{width:100%;font-size:16px}input{font-size:16px}table{width:100%}img{max-width:100%;height:auto;border-radius:8px}code{padding:2px 5px;background-color:rgb(var(--gray-light));border-radius:2px}pre{padding:1.5em;border-radius:8px}pre>code{all:unset}blockquote{border-left:4px solid var(--accent);padding:0 0 0 20px;margin:0;font-size:1.333em}hr{border:none;border-top:1px solid rgb(var(--gray-light))}@media (max-width: 720px){body{font-size:18px}main{padding:1em}}.sr-only{border:0;padding:0;margin:0;position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(50%);white-space:nowrap}a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}header[data-astro-cid-3ef6ksr2]{position:sticky;top:0;margin:0;padding:0 1em;background:#fff;box-shadow:0 2px 8px rgba(var(--black),5%)}h2[data-astro-cid-3ef6ksr2]{margin:0;font-size:1em}h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2],h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none}nav[data-astro-cid-3ef6ksr2]{display:flex;align-items:center;justify-content:space-between}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{padding:1em .5em;color:var(--black);border-bottom:4px solid transparent;text-decoration:none}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none;border-bottom-color:var(--accent)}.social-links[data-astro-cid-3ef6ksr2],.social-links[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{display:flex}@media (max-width: 720px){.social-links[data-astro-cid-3ef6ksr2]{display:none}}footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;background:linear-gradient(var(--gray-gradient)) no-repeat;color:rgb(var(--gray));text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}
main[data-astro-cid-bvzihdzo]{width:calc(100% - 2em);max-width:100%;margin:0}.hero-image[data-astro-cid-bvzihdzo]{width:100%}.hero-image[data-astro-cid-bvzihdzo] img[data-astro-cid-bvzihdzo]{display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.prose[data-astro-cid-bvzihdzo]{width:720px;max-width:calc(100% - 2em);margin:auto;padding:1em;color:rgb(var(--gray-dark))}.title[data-astro-cid-bvzihdzo]{margin-bottom:1em;padding:1em 0;text-align:center;line-height:1}.title[data-astro-cid-bvzihdzo] h1[data-astro-cid-bvzihdzo]{margin:0 0 .5em}.date[data-astro-cid-bvzihdzo]{margin-bottom:.5em;color:rgb(var(--gray))}.last-updated-on[data-astro-cid-bvzihdzo]{font-style:italic}
.astro-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px}
</style><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin=""><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin=""><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.B3vRBseb.js"></script><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.13.10"><link rel="canonical" href="https://bradito.me/blog/dont-jeopardize-your-rag/"><meta name="title" content="Don't jeopardize your RAG - RAG with Question Generation"><meta name="description" content="Why your Retrieval Augmented Generation (RAG) is underperforming, and what to do about it"><meta property="og:type" content="website"><meta property="og:url" content="https://bradito.me/blog/dont-jeopardize-your-rag/"><meta property="og:title" content="Don't jeopardize your RAG - RAG with Question Generation"><meta property="og:description" content="Why your Retrieval Augmented Generation (RAG) is underperforming, and what to do about it"><meta property="og:image" content="https://bradito.me/0004-jon-tyson-hhq1Lxtuwd8-unsplash.jpg"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://bradito.me/blog/dont-jeopardize-your-rag/"><meta property="twitter:title" content="Don't jeopardize your RAG - RAG with Question Generation"><meta property="twitter:description" content="Why your Retrieval Augmented Generation (RAG) is underperforming, and what to do about it"><meta property="twitter:image" content="https://bradito.me/0004-jon-tyson-hhq1Lxtuwd8-unsplash.jpg"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"></head> <body data-astro-cid-bvzihdzo> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <h2 data-astro-cid-3ef6ksr2><a href="/" data-astro-cid-3ef6ksr2>Brad Ito</a></h2> <div class="internal-links" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Blog </a>  <a href="/community" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Community </a>  <a href="/cv" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> CV </a>  </div> <div class="social-links" data-astro-cid-3ef6ksr2> <a href="https://www.linkedin.com/in/brad-ito/" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Follow Brad Ito on LinkedIn</span> <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" astro-icon="social/linkedin" data-astro-cid-3ef6ksr2> <path fill="currentColor" d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" data-astro-cid-3ef6ksr2></path> </svg> </a> <a href="https://twitter.com/phlogisticfugu" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Follow Brad Ito on Twitter</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" data-astro-cid-3ef6ksr2> <path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-3ef6ksr2></path> </svg> </a> <a href="https://github.com/phlogisticfugu/" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Go to Brad Ito's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" data-astro-cid-3ef6ksr2> <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path> </svg> </a> </div> </nav> </header>  <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo> <div class="hero-image" data-astro-cid-bvzihdzo> <img width="710" height="510" src="/0004-jon-tyson-hhq1Lxtuwd8-unsplash.jpg" alt="" data-astro-cid-bvzihdzo> </div> <div class="prose" data-astro-cid-bvzihdzo> <div class="title" data-astro-cid-bvzihdzo> <h1 data-astro-cid-bvzihdzo>Don&#39;t jeopardize your RAG - RAG with Question Generation</h1> <div class="date" data-astro-cid-bvzihdzo> <time datetime="2023-11-10T00:00:00.000Z"> Nov 9, 2023 </time> 
- Brad Ito
</div> <hr data-astro-cid-bvzihdzo> </div>  <p>Are you trying to build your own AI chatbot but finding it giving low quality responses?
Did you build a whole vector database, yet find that many questions don’t match to relevant context?
Then your Retrieval Augmented Generation (RAG) is in jeopardy, and this blog post is for you.</p>
<h3 id="the-problem">The Problem</h3>
<p>In the game of Jeopardy! one of the rules is that responses must be in the form of a question.
For example, a player is given an answer like “King Louis XIV ruled over this European country” and be
expected to come up with the question “What is France?”.  This is an awkward way of asking about trivia,
but it makes the game more challenging due to the extra mental steps.</p>
<p>The problem is that when most people are doing RAG, they are asking their vector database to do
extra mental steps.  This results in poor quality results.  Most knowledge documents are statements of facts, in narrative form.  For example, see the
<a href="https://en.wikipedia.org/wiki/France">wikipedia page for France</a>.  In a basic RAG setup, these documents are then
divided into smaller chunks.  Each chunk is sent through an embedding model, which creates a multi-dimensional vector.
The vectors are then stored in a vector database.</p>
<p><img src="/0004-jeopardize-rag-1.drawio.png" alt="Basic RAG"></p>
<p>Upon retrieval, the raw chat message is sent through the same embedding model, creating a “search vector”.  This is then
compared to all of the other vectors currently in the vector database to see which document chunk or chunks are most similar.
The retrieved document chunks are then used by a Large Language Model (LLM) to create a more-informed response to the original question.</p>
<p>The problem is that there is a fundamental semantic mismatch between the vectors being compared.  We’re trying to compare <em>questions</em> (from the chat message)
to <em>answers</em> (from the document chunks).  The embedding vector for a question will always be different from the embedding vector
for an answer.  This leads to unnecessarily poor performance of the RAG process.</p>
<h3 id="partial-solution-hypothetical-document-embedding-hyde">Partial Solution: Hypothetical Document Embedding (HyDE)</h3>
<p>One way that we can improve performance is <a href="https://arxiv.org/abs/2212.10496">Hypothetical Document Embedding (HyDE)</a>.
This approach uses an LLM to transform the input chat message into answer form, even if it has to hallucinate the answer.</p>
<p>For example, it would turn an input question such as “What is the capital of France?” into a hypothetical answer
“The capital of France is New Jersey”.</p>
<p><img src="/0004-jeopardize-rag-2.drawio.png" alt="RAG with HyDE"></p>
<p>This hypothetical answer is wrong, but it’s embedding vector is likely to more closely match
the document chunks.  With HyDE, we are matching <em>answers</em> to <em>answers</em>, resulting in more similar embedding vectors.
Note that, to get the most out of this approach, it is a good idea to also try to match the original
question in addition to the hypothetical answer.</p>
<h3 id="new-solution-rag-with-question-generation">New Solution: RAG with Question Generation</h3>
<p>An improved solution is to do pre-processing on the document chunks before they go into the vector database.
We can ask an LLM to generate questions which are best answered by the document chunk.</p>
<p>For example, take text from the <a href="https://en.wikipedia.org/wiki/France">wikipedia page for France</a>.
Then send the LLM a prompt: “Generate a list of standard questions best answered by: {text}”
and it generates questions such as: “What is the capital of the country France?”.  Use the resulting
questions, generate embedding vectors for each, and store them in the vector database, with a reference
to the original document text to use as context.</p>
<p><img src="/0004-jeopardize-rag-3.drawio.png" alt="RAG with Question Generation"></p>
<p>This method uses the vector database to compare <em>questions</em> to <em>questions</em>, resulting in better RAG performance.
The vectors for the user’s chat question and the generated questions are much closer, potentially even exactly the same.
While this does result in more vectors to search, that leverages the strength of a database, which is to make that search
<a href="https://www.pinecone.io/learn/series/faiss/hnsw/">fast and efficient</a>.</p>
<p>In a full implementation, combine all three semantic match techniques:</p>
<ul>
<li>original <em>question</em> to document chunk <em>“answer”</em></li>
<li>generated hypothetical <em>answer</em> to document chunk <em>answer</em> (HyDE)</li>
<li>original <em>question</em> to generated <em>question</em> (NEW)</li>
</ul>
<p>This ensures that we maximize the chances for a better semantic match, resulting in better context being retrieved
and better knowledge for our chatbot.  We haven’t found any academic papers about this approach, but in our own empirical
testing it gives better results.</p>
<h3 id="next-steps">Next Steps</h3>
<p>If you’d like to try this out for yourself, we also made two open source tools which may be of interest.</p>
<p><a href="https://github.com/novex-ai/chatbot-confidential/">chatbot-confidential</a> is a fully-local (no data in the cloud, no API calls to the cloud)
knowledge chatbot which can run on your own desktop or laptop.  It is still in beta, but it uses both of the approaches described
in this blog post, and some initial testing has shown this to be promising.</p>
<p><a href="https://pypi.org/project/parallel-parrot/">parallel-parrot</a> is a Python package which optimizes parallel calls to the OpenAI Chat API.
It can be used to efficiently generate questions from thousands of document chunks at a time, without having to worry about rate limits or
throttling of the API.</p>
<p>Ready to implement Generative AI in your own company operations?  Contact us at
<a href="https://novex.ai/">Novex AI</a> to tailor an effective solution that fits your needs.</p>
<hr>
<p>Cover photo by <a href="https://unsplash.com/@jontyson?utm_content=creditCopyText&#x26;utm_medium=referral&#x26;utm_source=unsplash">Jon Tyson</a>
on <a href="https://unsplash.com/photos/white-markee-light-hhq1Lxtuwd8?utm_content=creditCopyText&#x26;utm_medium=referral&#x26;utm_source=unsplash">Unsplash</a></p>  </div> </article> </main> <footer data-astro-cid-sz7xmlte>
&copy; 2025 Brad Ito. All rights reserved.
<div class="social-links" data-astro-cid-sz7xmlte> <a href="https://www.linkedin.com/in/brad-ito/" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Follow Brad Ito on LinkedIn</span> <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" astro-icon="social/linkedin" data-astro-cid-sz7xmlte> <path fill="currentColor" d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" data-astro-cid-sz7xmlte></path> </svg> </a> <a href="https://twitter.com/phlogisticfugu" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Follow Brad Ito on Twitter</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" data-astro-cid-sz7xmlte> <path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-sz7xmlte></path> </svg> </a> <a href="https://github.com/phlogisticfugu/" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Go to Brad Ito's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" data-astro-cid-sz7xmlte> <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path> </svg> </a> </div> </footer>  </body></html>