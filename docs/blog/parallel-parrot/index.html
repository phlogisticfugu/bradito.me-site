<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo><head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v3.2.2"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://bradito.me/blog/parallel-parrot/"><!-- Primary Meta Tags --><title>Accelerating LLM operations with parallel-parrot</title><meta name="title" content="Accelerating LLM operations with parallel-parrot"><meta name="description" content="Wrangling a flock of LLMs for speed, fun, and profit"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://bradito.me/blog/parallel-parrot/"><meta property="og:title" content="Accelerating LLM operations with parallel-parrot"><meta property="og:description" content="Wrangling a flock of LLMs for speed, fun, and profit"><meta property="og:image" content="https://bradito.me/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://bradito.me/blog/parallel-parrot/"><meta property="twitter:title" content="Accelerating LLM operations with parallel-parrot"><meta property="twitter:description" content="Wrangling a flock of LLMs for speed, fun, and profit"><meta property="twitter:image" content="https://bradito.me/blog-placeholder-1.jpg"><style>:root{--accent: #2337ff;--accent-dark: #000d8a;--black: 15, 18, 25;--gray: 96, 115, 159;--gray-light: 229, 233, 240;--gray-dark: 34, 41, 57;--gray-gradient: rgba(var(--gray-light), 50%), #fff;--box-shadow: 0 2px 6px rgba(var(--gray), 25%), 0 8px 24px rgba(var(--gray), 33%), 0 16px 32px rgba(var(--gray), 33%)}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-regular.woff) format("woff");font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-bold.woff) format("woff");font-weight:700;font-style:normal;font-display:swap}body{font-family:Atkinson,sans-serif;margin:0;padding:0;text-align:left;background:linear-gradient(var(--gray-gradient)) no-repeat;background-size:100% 600px;word-wrap:break-word;overflow-wrap:break-word;color:rgb(var(--gray-dark));font-size:20px;line-height:1.7}main{width:720px;max-width:calc(100% - 2em);margin:auto;padding:3em 1em}h1,h2,h3,h4,h5,h6{margin:0 0 .5rem;color:rgb(var(--black));line-height:1.2}h1{font-size:3.052em}h2{font-size:2.441em}h3{font-size:1.953em}h4{font-size:1.563em}h5{font-size:1.25em}strong,b{font-weight:700}a,a:hover{color:var(--accent)}p{margin-bottom:1em}.prose p{margin-bottom:2em}textarea{width:100%;font-size:16px}input{font-size:16px}table{width:100%}img{max-width:100%;height:auto;border-radius:8px}code{padding:2px 5px;background-color:rgb(var(--gray-light));border-radius:2px}pre{padding:1.5em;border-radius:8px}pre>code{all:unset}blockquote{border-left:4px solid var(--accent);padding:0 0 0 20px;margin:0;font-size:1.333em}hr{border:none;border-top:1px solid rgb(var(--gray-light))}@media (max-width: 720px){body{font-size:18px}main{padding:1em}}.sr-only{border:0;padding:0;margin:0;position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(50%);white-space:nowrap}a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}header[data-astro-cid-3ef6ksr2]{margin:0;padding:0 1em;background:white;box-shadow:0 2px 8px rgba(var(--black),5%)}h2[data-astro-cid-3ef6ksr2]{margin:0;font-size:1em}h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2],h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none}nav[data-astro-cid-3ef6ksr2]{display:flex;align-items:center;justify-content:space-between}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{padding:1em .5em;color:var(--black);border-bottom:4px solid transparent;text-decoration:none}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none;border-bottom-color:var(--accent)}.social-links[data-astro-cid-3ef6ksr2],.social-links[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{display:flex}@media (max-width: 720px){.social-links[data-astro-cid-3ef6ksr2]{display:none}}footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;background:linear-gradient(var(--gray-gradient)) no-repeat;color:rgb(var(--gray));text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}
main[data-astro-cid-bvzihdzo]{width:calc(100% - 2em);max-width:100%;margin:0}.hero-image[data-astro-cid-bvzihdzo]{width:100%}.hero-image[data-astro-cid-bvzihdzo] img[data-astro-cid-bvzihdzo]{display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.prose[data-astro-cid-bvzihdzo]{width:720px;max-width:calc(100% - 2em);margin:auto;padding:1em;color:rgb(var(--gray-dark))}.title[data-astro-cid-bvzihdzo]{margin-bottom:1em;padding:1em 0;text-align:center;line-height:1}.title[data-astro-cid-bvzihdzo] h1[data-astro-cid-bvzihdzo]{margin:0 0 .5em}.date[data-astro-cid-bvzihdzo]{margin-bottom:.5em;color:rgb(var(--gray))}.last-updated-on[data-astro-cid-bvzihdzo]{font-style:italic}
</style><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="manifest" href="/manifest.webmanifest"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" content="#fff"><meta name="application-name" content="Welcome to Astro Favicons."><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Astro Favicons"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#fff"><meta name="msapplication-TileColor" content="#fff"><meta name="msapplication-config" content="/browserconfig.xml"><link rel="yandex-tableau-widget" href="/yandex-browser-manifest.json"></head><body data-astro-cid-bvzihdzo><header data-astro-cid-3ef6ksr2><nav data-astro-cid-3ef6ksr2><h2 data-astro-cid-3ef6ksr2><a href="/" data-astro-cid-3ef6ksr2>Brad Ito</a></h2><div class="internal-links" data-astro-cid-3ef6ksr2><a href="/" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg>Blog</a><a href="/community" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg>Community</a><a href="/cv" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg>CV</a></div><div class="social-links" data-astro-cid-3ef6ksr2><a href="https://www.linkedin.com/in/brad-ito/" target="_blank" data-astro-cid-3ef6ksr2><span class="sr-only" data-astro-cid-3ef6ksr2>Follow Brad Ito on LinkedIn</span><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" astro-icon="social/linkedin" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" data-astro-cid-3ef6ksr2></path></svg></a><a href="https://twitter.com/phlogisticfugu" target="_blank" data-astro-cid-3ef6ksr2><span class="sr-only" data-astro-cid-3ef6ksr2>Follow Brad Ito on Twitter</span><svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-3ef6ksr2></path></svg></a><a href="https://github.com/phlogisticfugu/" target="_blank" data-astro-cid-3ef6ksr2><span class="sr-only" data-astro-cid-3ef6ksr2>Go to Brad Ito's GitHub repo</span><svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path></svg></a></div></nav></header><main data-astro-cid-bvzihdzo><article data-astro-cid-bvzihdzo><div class="hero-image" data-astro-cid-bvzihdzo><img width="1020" height="510" src="/0002-gareth-davies-EGcfyDiUv58-unsplash.jpg" alt="" data-astro-cid-bvzihdzo></div><div class="prose" data-astro-cid-bvzihdzo><div class="title" data-astro-cid-bvzihdzo><h1 data-astro-cid-bvzihdzo>Accelerating LLM operations with parallel-parrot</h1><div class="date" data-astro-cid-bvzihdzo><time datetime="2023-09-25T00:00:00.000Z">Sep 24, 2023</time>
- Brad Ito
</div><hr data-astro-cid-bvzihdzo></div><p>Large Language Models (LLMs) have revolutionized task automation, yet scaling these
operations poses challenges in efficiency and reliability.
We’ve developed <a href="https://pypi.org/project/parallel-parrot/">parallel-parrot</a>
, a Python package that parallelizes LLM tasks to boost performance and reliability.</p>
<h3 id="task-automation-with-prompt-templates">Task Automation with Prompt Templates</h3>
<p>To instruct the LLM about the task we wish to perform, we use prompt templates
developed using <a href="https://www.promptingguide.ai/">prompt engineering</a></p>
<p><img src="/0002-parallel-parrot-1.drawio.png" alt="Using prompts with context"></p>
<p>The idea is to design a prompt template that will take in an <code>input</code> and
<code>context</code>, and use that to generate a text <code>prompt</code>.  This then gives the LLM the instructions it needs to generate the type of output desired.</p>
<p>For example, to shorten long documents while keeping their meaning, design a prompt template like:</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">Generate a concise summary of the following document, using the context provided:</span></span>
<span class="line"><span style="color: #e1e4e8">context: ${context}</span></span>
<span class="line"><span style="color: #e1e4e8">document: ${document}</span></span></code></pre>
<p>We then use <a href="https://peps.python.org/pep-0292/">code</a> to replace <code>${context}</code> with each context and replace <code>${document}</code> with the text of each document being processed.
The same prompt template serves many purposes. From summarizing company blog posts, to making meeting notes easier to review.  And it does so while injecting appropriate business context.</p>
<h3 id="generating-data">Generating Data</h3>
<p>We’ve found that as one gets to more advanced use-cases, that the outputs that you want from the LLM inevitably become more complicated.  For example:</p>
<ul>
<li>Using a long document to generate several “Frequently Asked Questions”, in question and answer pairs</li>
<li>Parsing a document for multiple topics, and infer the sentiment (POSITIVE, NEUTRAL, or NEGATIVE) of each topic</li>
<li>Identifying corporate entities in a document, and the role for each of them in the document (vendor, client, etc)</li>
</ul>
<p>For this we can leverage two features provided by modern LLM APIs:</p>
<ul>
<li><strong>JSON-formatted outputs</strong>: Allows for easier parsing.  For OpenAI, this is the <a href="https://platform.openai.com/docs/guides/gpt/chat-completions-api">“function calling”</a> feature</li>
<li><strong>Multiple Choices</strong>:  Generate multiple different outputs for each request.  This can make it more likely that one of the outputs best matches the goal you are trying to achieve.  For OpenAI, this is specified by setting the number of choices (<code>n</code>) to be greater than one.</li>
</ul>
<p><img src="/0002-parallel-parrot-2.drawio.png" alt="Structured LLM output"></p>
<p>For example, say we use the prompt template:</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">Generate question and answer pairs from the following document.</span></span>
<span class="line"><span style="color: #e1e4e8">Output a list of JSON objects with keys "question" and "answer".</span></span>
<span class="line"><span style="color: #e1e4e8">Only output questions and answers clearly described in the document.</span></span>
<span class="line"><span style="color: #e1e4e8">document: ${text}</span></span></code></pre>
<p>This could turn a <a href="https://en.wikipedia.org/wiki/George_Washington">wikipedia page about George Washington</a> into a list of question and answer pairs:</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #E1E4E8">[</span></span>
<span class="line"><span style="color: #E1E4E8">  {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"question"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"Who was the first president of the United States?"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"answer"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"George Washington"</span></span>
<span class="line"><span style="color: #E1E4E8">  },</span></span>
<span class="line"><span style="color: #E1E4E8">  {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"question"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"What position did George Washington hold during the American Revolutionary War?"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"answer"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"Commander of the Continental Army"</span></span>
<span class="line"><span style="color: #E1E4E8">  },</span></span>
<span class="line"><span style="color: #E1E4E8">  {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"question"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"What document did George Washington help draft and ratify?"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"answer"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"The Constitution of the United States"</span></span>
<span class="line"><span style="color: #E1E4E8">  },</span></span>
<span class="line"><span style="color: #E1E4E8">]</span></span></code></pre>
<p>These question and answer pairs could then be used to:</p>
<ul>
<li>Create a new document of “Frequenty Asked Questions”</li>
<li>Make the content easier to skim for a reader</li>
<li>Improve search database matches.  User questions typically match more closely to LLM generated questions than to original documents.</li>
</ul>
<h3 id="scale">Scale</h3>
<p>The above is powerful, but it starts to get tricky when you try to scale to thousands of tasks.  Processing a thousand documents one after the other (in series) could take over 8 hours.  And if there is an API or network error near the end, it could force you to start all over.</p>
<p>To address this, we created a python package: <a href="https://pypi.org/project/parallel-parrot/">parallel-parrot</a> which makes LLM calls in parallel.  It deals with all the issues related to concurrency, retries, API throttling, and other low-level concerns.  Parallelization reduces the total time for processing a thousand documents from hours to minutes.</p>
<p>Series vs Parallel:
<img src="/0002-parallel-parrot-3.drawio.png" alt="Series vs Parallel"></p>
<p><a href="https://pypi.org/project/parallel-parrot/">parallel-parrot</a> automatically:</p>
<ul>
<li>Takes in a pandas dataframe or native Python list of dictionaries</li>
<li>Applies a prompt template to create a prompt per row</li>
<li>Queries an API-based LLM in parallel, handling automatic retries and rate limiting</li>
<li>Parses and dedupes the outputs from multiple choices, and from JSON outputs</li>
<li>Outputs clean (<a href="https://towardsdatascience.com/why-and-how-to-explode-a-list-like-column-to-rows-in-pandas-b69c3391c01c/">exploded</a> / <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html">tidy</a> ) data in the original format</li>
</ul>
<p>For example, it can take in multiple rows of input data:</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #E1E4E8">[</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">"text"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"George Washington (February 22, 1732 - December 14, 1799) was ..."</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">"source_url"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"https://en.wikipedia.org/wiki/George_Washington"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    },</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">"text"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"John Adams (October 30, 1735 - July 4, 1826) was ..."</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">"source_url"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"https://en.wikipedia.org/wiki/John_Adams"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    },</span></span>
<span class="line"><span style="color: #E1E4E8">]</span></span>
<span class="line"></span></code></pre>
<p>Then use a few lines of Python:</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> parallel_parrot </span><span style="color: #F97583">as</span><span style="color: #E1E4E8"> pp</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">config </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> pp.OpenAIChatCompletionConfig(</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #FFAB70">openai_api_key</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">"*your API key*"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #FFAB70">n</span><span style="color: #F97583">=</span><span style="color: #79B8FF">3</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #FFAB70">system_message</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">"you are a very precise assistant"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">(output, usage_stats) </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> pp.run_async(</span></span>
<span class="line"><span style="color: #E1E4E8">    pp.parallel_data_generation(</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #FFAB70">config</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">config,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #FFAB70">input_data</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">input_data,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #FFAB70">prompt_template</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">"""</span></span>
<span class="line"><span style="color: #9ECBFF">Generate question and answer pairs from the following document.</span></span>
<span class="line"><span style="color: #9ECBFF">Output a list of JSON objects with keys "question" and "answer".</span></span>
<span class="line"><span style="color: #9ECBFF">Only output questions and answers clearly described in the document.</span></span>
<span class="line"><span style="color: #9ECBFF">If there are no questions and answers, output an empty list.</span></span>
<span class="line"><span style="color: #9ECBFF">document: $</span><span style="color: #79B8FF">{text}</span></span>
<span class="line"><span style="color: #9ECBFF">        """</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #FFAB70">output_key_names</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">[</span><span style="color: #9ECBFF">"question"</span><span style="color: #E1E4E8">, </span><span style="color: #9ECBFF">"answer"</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #E1E4E8">    )</span></span>
<span class="line"><span style="color: #E1E4E8">)</span></span></code></pre>
<p>To generate useful question and answer pairs:</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #E1E4E8">[</span></span>
<span class="line"><span style="color: #E1E4E8">  {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"text"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"..."</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"source_url"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"https://en.wikipedia.org/wiki/George_Washington"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"question"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"Who was the first president of the United States?"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"answer"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"George Washington"</span></span>
<span class="line"><span style="color: #E1E4E8">  },</span></span>
<span class="line"><span style="color: #E1E4E8">  {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"text"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"..."</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"source_url"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"https://en.wikipedia.org/wiki/George_Washington"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"question"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"What position did George Washington hold during the American Revolutionary War?"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"answer"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"Commander of the Continental Army"</span></span>
<span class="line"><span style="color: #E1E4E8">  },</span></span>
<span class="line"><span style="color: #E1E4E8">  {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"text"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"..."</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"source_url"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"https://en.wikipedia.org/wiki/George_Washington"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"question"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"What document did George Washington help draft and ratify?"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"answer"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"The Constitution of the United States"</span></span>
<span class="line"><span style="color: #E1E4E8">  },</span></span>
<span class="line"><span style="color: #E1E4E8">  {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"text"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"..."</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"source_url"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"https://en.wikipedia.org/wiki/John_Adams"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"question"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"Who were some important contemporaries that John Adams corresponded with?"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"answer"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"Adams regularly corresponded with important contemporaries, including his wife and adviser Abigail Adams and his friend and political rival Thomas Jefferson."</span></span>
<span class="line"><span style="color: #E1E4E8">  },</span></span>
<span class="line"><span style="color: #E1E4E8">  {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"text"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"..."</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"source_url"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"https://en.wikipedia.org/wiki/John_Adams"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"question"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"Who was John Adams?"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"answer"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"John Adams was an American statesman, attorney, diplomat, writer, and Founding Father."</span></span>
<span class="line"><span style="color: #E1E4E8">  },</span></span>
<span class="line"><span style="color: #E1E4E8">]</span></span></code></pre>
<p>Under the hood, it uses the high-performance <a href="https://docs.aiohttp.org/en/stable/">aiohttp</a> package.  And uses the efficient I/O library <a href="https://libuv.org/">libuv</a> via <a href="https://github.com/MagicStack/uvloop">uvloop</a>.  It also uses best practices such as exponential backoff with jitter to deal with connection timeouts and retries.</p>
<p>Depending on the API-based LLM you are using, some require time to “warm up” machines in the cloud.  Other APIs like OpenAI have <a href="https://platform.openai.com/docs/guides/rate-limits/rate-limits-in-headers">rate limits</a> which can vary depending on account tier.  The package handles both of these by first making a “setup” request.  That request is used to configure and optimize the main parallel requests.  That same initial request also makes it easier to debug show-stopper issues like invalid credentials or API downtime.</p>
<p><img src="/0002-parallel-parrot-4.drawio.png" alt="Setup request before batch"></p>
<h3 id="next-steps">Next Steps</h3>
<p>We’re open sourcing this <a href="https://github.com/novex-ai/parallel-parrot">package</a> in the true spirit of open source: in the hopes that others find it useful as well.  Contributions and feedback are welcome, in the hopes that we can help each other unlock more of the value from this exciting new technology.</p>
<p>Ready to implement Generative AI in your own company operations?  Contact us at
<a href="https://novex.ai/">Novex AI</a> to tailor an effective solution that fits your needs.</p></div></article></main><footer data-astro-cid-sz7xmlte>
&copy; 2023 Brad Ito. All rights reserved.
<div class="social-links" data-astro-cid-sz7xmlte><a href="https://www.linkedin.com/in/brad-ito/" target="_blank" data-astro-cid-sz7xmlte><span class="sr-only" data-astro-cid-sz7xmlte>Follow Brad Ito on LinkedIn</span><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" astro-icon="social/linkedin" data-astro-cid-sz7xmlte><path fill="currentColor" d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" data-astro-cid-sz7xmlte></path></svg></a><a href="https://twitter.com/phlogisticfugu" target="_blank" data-astro-cid-sz7xmlte><span class="sr-only" data-astro-cid-sz7xmlte>Follow Brad Ito on Twitter</span><svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" data-astro-cid-sz7xmlte><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-sz7xmlte></path></svg></a><a href="https://github.com/phlogisticfugu/" target="_blank" data-astro-cid-sz7xmlte><span class="sr-only" data-astro-cid-sz7xmlte>Go to Brad Ito's GitHub repo</span><svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" data-astro-cid-sz7xmlte><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path></svg></a></div></footer></body></html>